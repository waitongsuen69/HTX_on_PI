<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cost Basis Lots</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; color: #eaeaea; background: #111; }
      .nav { display:flex; gap:10px; align-items:center; padding:10px 16px; background:#0d141d; border-bottom:1px solid #1a2330; position:sticky; top:0; z-index:10; margin:-16px -16px 8px -16px; }
      .nav a { color:#c9d7ee; text-decoration:none; padding:6px 10px; border-radius:8px; border:1px solid transparent; }
      .nav a.active { background:#13202e; border-color:#24354a; color:#fff; }
      header { display:flex; align-items:center; gap:12px; margin-bottom: 12px; }
      header .badge { background:#333; padding:2px 8px; border-radius:999px; font-size:12px; }
      button, input, select { background:#222; color:#eee; border:1px solid #444; border-radius:6px; padding:6px 10px; }
      table { width:100%; border-collapse: collapse; margin-top: 8px; }
      th, td { border-bottom:1px solid #333; padding:6px; text-align:left; font-size: 14px; }
      th { position: sticky; top: 0; background:#111; }
      .row { display:flex; gap:8px; flex-wrap: wrap; }
      .card { background:#151515; border:1px solid #2a2a2a; border-radius:8px; padding:10px; }
      .toast { position: fixed; bottom: 12px; right: 12px; background:#222; color:#eee; border:1px solid #444; padding:8px 12px; border-radius:6px; display:none; }
      /* Sync status icons */
      .spinner { display:inline-block; width:14px; height:14px; border:2px solid #3a3a3a; border-top-color:#0aaef0; border-radius:50%; animation: spin 0.9s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .icon-ok { color:#16c784; font-weight:700; }
      .icon-err { color:#ea3943; font-weight:700; }
    </style>
    <script defer src="/lots.js"></script>
  </head>
  <body>
    <div class="nav">
      <a id="nav-dashboard" href="/">Dashboard</a>
      <a id="nav-lots" href="/lots.html">Lots</a>
    </div>
    <header>
      <h2 style="margin:0">Cost Basis Lots</h2>
      <span id="backend" class="badge"></span>
      <span id="updated" class="badge"></span>
      <div style="margin-left:auto" class="row">
        <button id="btnExportCsv">Export CSV</button>
        <button id="btnExportJson">Export JSON</button>
        <button id="btnSyncTrades">Sync 120d Trades</button>
        <label>
          <input type="file" id="fileInput" accept=".csv" style="display:none" />
          <button id="btnImport">Import CSV</button>
        </label>
      </div>
    </header>
    <div class="card" style="margin-bottom:8px">
      <div class="row" style="align-items:center; gap:8px">
        <span id="syncIcon" aria-label="status" title="status"></span>
        <progress id="syncProgress" value="0" max="100" style="width:240px"></progress>
        <span id="syncLog" style="font-size:12px; opacity:0.9"></span>
      </div>
      <div id="syncFeed" style="margin-top:6px; max-height:120px; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:12px; opacity:0.8; border-top:1px solid #2a2a2a; padding-top:6px"></div>
    </div>

    <div class="row">
      <div class="card" style="flex:1 1 260px">
        <div class="row">
          <select id="assetFilter"></select>
          <button id="btnRefresh">Refresh</button>
        </div>
        <div style="margin-top:8px" class="row">
          <input id="date" type="datetime-local" />
          <input id="asset" placeholder="Asset (e.g., TRX)" />
          <select id="action">
            <option>buy</option><option>sell</option><option>deposit</option><option>withdraw</option>
          </select>
          <input id="qty" type="number" step="any" placeholder="Qty" />
          <input id="unit_cost_usd" type="number" step="any" placeholder="Unit Cost USD" />
          <input id="note" placeholder="Note" />
          <button id="btnCreate">Create</button>
        </div>
      </div>
      <div class="card" style="flex:2 1 400px">
        <div id="summary"></div>
        <table id="lotsTable">
          <thead>
            <tr><th>ID</th><th>Date</th><th>Asset</th><th>Action</th><th>Qty</th><th>Unit Cost</th><th>Note</th><th></th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="toast" class="toast"></div>
    <script>
      const p = location.pathname;
      if (p === '/' || p === '/index.html') document.getElementById('nav-dashboard').classList.add('active');
      if (p.endsWith('/lots.html')) document.getElementById('nav-lots').classList.add('active');
    </script>
  </body>
  </html>
